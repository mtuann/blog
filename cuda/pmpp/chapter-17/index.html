
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mtuann.github.io/blog/cuda/pmpp/chapter-17/">
      
      
        <link rel="prev" href="../chapter-16/">
      
      
        <link rel="next" href="../chapter-18/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Chapter 17: MRI Reconstruction - Tuan's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Outfit:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Outfit";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-17-mri-reconstruction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Tuan&#39;s Blog" class="md-header__button md-logo" aria-label="Tuan's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tuan's Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 17: MRI Reconstruction
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/mtuann/blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    mtuann/blog
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ml/theory/" class="md-tabs__link">
          
  
  
    
  
  Machine Learning

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../genai/" class="md-tabs__link">
          
  
  
    
  
  Generative AI

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../ai-systems/" class="md-tabs__link">
        
  
  
    
  
  AI Systems

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  CUDA Engineering

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../efficient-ai/" class="md-tabs__link">
        
  
  
    
  
  Efficient AI

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../trustworthy-ai/" class="md-tabs__link">
        
  
  
    
  
  Trustworthy AI

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../paper-reviews/" class="md-tabs__link">
        
  
  
    
  
  Paper Reviews

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Tuan&#39;s Blog" class="md-nav__button md-logo" aria-label="Tuan's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Tuan's Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mtuann/blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    mtuann/blog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Machine Learning
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Machine Learning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ml/theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Theory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ml/practice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Practice
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../genai/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Generative AI
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Generative AI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../genai/transformer-attention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transformer Foundations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai-systems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Systems
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    CUDA Engineering
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    CUDA Engineering
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    PMPP Book
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2" id="__nav_5_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    PMPP Book
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1: Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2: Data Parallel Computing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3: Multidimensional Grids
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4: Compute Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5: Memory Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6: Performance Considerations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7: Convolution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8: Stencil
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9: Parallel Histogram
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 10: Reduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 11: Prefix Sum (Scan)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 12: Parallel Merge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 13: Parallel Sorting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 14: Sparse Matrix Computation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 15: Parallel Graph Algorithms
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 16: Deep Learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Chapter 17: MRI Reconstruction
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 17: MRI Reconstruction
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#en-background" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.1 Background
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-iterative" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.2 Iterative Reconstruction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.3 Computing \(F^H D\) (Step-by-Step Optimization)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="17.3 Computing \(F^H D\) (Step-by-Step Optimization)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-parallelism-structure-scatter-vs-gather" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Parallelism Structure (Scatter vs. Gather)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-managing-memory-bandwidth" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Managing Memory Bandwidth
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-hardware-trigonometry-sfus" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Hardware Trigonometry (SFUs)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-constant-memory-cache-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Constant Memory &amp; Cache Efficiency
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.4 Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-background" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.1 Bối cảnh
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-iterative" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.2 Tái tạo lặp
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.3 Tính toán \(F^H D\) (Tối ưu hóa từng bước)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="17.3 Tính toán \(F^H D\) (Tối ưu hóa từng bước)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buoc-1-cau-truc-song-song-scatter-vs-gather" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bước 1: Cấu trúc song song (Scatter vs. Gather)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buoc-2-quan-ly-bang-thong-bo-nho" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bước 2: Quản lý băng thông bộ nhớ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buoc-3-luong-giac-phan-cung-sfus" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bước 3: Lượng giác phần cứng (SFUs)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buoc-4-constant-memory-hieu-qua-cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bước 4: Constant Memory &amp; Hiệu quả Cache
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.4 Tóm tắt
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 18: Molecular Dynamics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 19: Programming Strategy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 20: Heterogeneous Clusters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 21: Dynamic Parallelism
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 22: Evolution and Trends
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 23: Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix-a/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Appendix A: Numerical Issues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../engineer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GPU Engineer Roadmap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../efficient-ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Efficient AI
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../trustworthy-ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Trustworthy AI
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper-reviews/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Paper Reviews
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#en-background" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.1 Background
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-iterative" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.2 Iterative Reconstruction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.3 Computing \(F^H D\) (Step-by-Step Optimization)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="17.3 Computing \(F^H D\) (Step-by-Step Optimization)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-parallelism-structure-scatter-vs-gather" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Parallelism Structure (Scatter vs. Gather)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-managing-memory-bandwidth" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Managing Memory Bandwidth
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-hardware-trigonometry-sfus" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Hardware Trigonometry (SFUs)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-constant-memory-cache-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Constant Memory &amp; Cache Efficiency
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.4 Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-background" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.1 Bối cảnh
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-iterative" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.2 Tái tạo lặp
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.3 Tính toán \(F^H D\) (Tối ưu hóa từng bước)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="17.3 Tính toán \(F^H D\) (Tối ưu hóa từng bước)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buoc-1-cau-truc-song-song-scatter-vs-gather" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bước 1: Cấu trúc song song (Scatter vs. Gather)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buoc-2-quan-ly-bang-thong-bo-nho" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bước 2: Quản lý băng thông bộ nhớ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buoc-3-luong-giac-phan-cung-sfus" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bước 3: Lượng giác phần cứng (SFUs)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buoc-4-constant-memory-hieu-qua-cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bước 4: Constant Memory &amp; Hiệu quả Cache
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.4 Tóm tắt
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="chapter-17-mri-reconstruction">Chapter 17: MRI Reconstruction<a class="headerlink" href="#chapter-17-mri-reconstruction" title="Permanent link">&para;</a></h1>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">English</label><label for="__tabbed_1_2">Tiếng Việt</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Magnetic Resonance Imaging (MRI) is a vital medical diagnostic tool. This chapter uses MRI reconstruction to demonstrate how to optimize kernels that involve complex mathematical formulas and high memory bandwidth requirements.</p>
<h2 id="en-background">17.1 Background<a class="headerlink" href="#en-background" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>MRI Process:</strong> Consists of two phases: <strong>Acquisition</strong> (scanning) and <strong>Reconstruction</strong> (creating the image).</li>
<li><strong>K-Space:</strong> Data is sampled in the frequency domain (k-space).</li>
<li><strong>Cartesian vs. Non-Cartesian:</strong><ul>
<li><strong>Cartesian scans</strong> are on a uniform grid and can be solved quickly using Fast Fourier Transforms (FFT).</li>
<li><strong>Non-Cartesian scans</strong> (e.g., spirals) are better for imaging moving organs or patients but are much harder to solve. They require <strong>Iterative Reconstruction</strong>.</li>
</ul>
</li>
<li><strong>The Bottleneck:</strong> On a high-end sequential CPU, a single 3D reconstruction can take <strong>3 hours</strong>, which is too slow for clinical use.</li>
</ul>
<h2 id="en-iterative">17.2 Iterative Reconstruction<a class="headerlink" href="#en-iterative" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Mathematical Model:</strong> Uses a linear solver approach to estimate voxel values (<span class="arithmatex">\(\rho\)</span>) from irregular samples.</li>
<li><strong>Problem Scale:</strong> Even a modest <span class="arithmatex">\(128^3\)</span> voxel reconstruction involves millions of calculations.</li>
<li><strong>Objective:</strong> Reduce reconstruction time from hours to <strong>minutes</strong> using the GPU.</li>
</ul>
<h2 id="en-optimization">17.3 Computing <span class="arithmatex">\(F^H D\)</span> (Step-by-Step Optimization)<a class="headerlink" href="#en-optimization" title="Permanent link">&para;</a></h2>
<p>The core of the chapter involves optimizing the most expensive part of the solver, the calculation of the <span class="arithmatex">\(F^H D\)</span> vector.</p>
<h3 id="step-1-parallelism-structure-scatter-vs-gather">Step 1: Parallelism Structure (Scatter vs. Gather)<a class="headerlink" href="#step-1-parallelism-structure-scatter-vs-gather" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Scatter Approach:</strong> Each thread takes one input (k-space sample) and updates all output voxels. This requires heavy use of <strong>Atomic Operations</strong>, making it very slow.</li>
<li><strong>Gather Approach (Preferred):</strong> Each thread is assigned to one output voxel and "gathers" the contributions from all input samples. This eliminates the need for atomics and is much faster.</li>
<li><strong>Loop Fission:</strong> To enable the gather approach, the authors use "loop fission" to split the calculation into two separate kernels, ensuring data is ready when the threads need to gather it.</li>
</ul>
<h3 id="step-2-managing-memory-bandwidth">Step 2: Managing Memory Bandwidth<a class="headerlink" href="#step-2-managing-memory-bandwidth" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Register Usage:</strong> In the original loop, the thread repeatedly reads voxel coordinates <span class="arithmatex">\((x, y, z)\)</span> from global memory.</li>
<li><strong>The Fix:</strong> Load these coordinates into <strong>Registers</strong> once before the loop starts. This increases the compute-to-memory ratio from <strong>0.23 to 0.46 OP/B</strong>.</li>
</ul>
<h3 id="step-3-hardware-trigonometry-sfus">Step 3: Hardware Trigonometry (SFUs)<a class="headerlink" href="#step-3-hardware-trigonometry-sfus" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Trigonometry Bottleneck:</strong> The math requires constant <code>sin()</code> and <code>cos()</code> calls.</li>
<li><strong>The Fix:</strong> Use <strong>Intrinsic Functions</strong> (<code>__sin()</code>, <code>__cos()</code>). These are executed by the GPU's <strong>Special Function Units (SFU)</strong>.</li>
<li><strong>Trade-off:</strong> These are much faster but slightly less accurate. The authors use <strong>PSNR</strong> (Peak Signal-to-Noise Ratio) to prove the accuracy loss is negligible for medical diagnosis.</li>
</ul>
<h3 id="step-4-constant-memory-cache-efficiency">Step 4: Constant Memory &amp; Cache Efficiency<a class="headerlink" href="#step-4-constant-memory-cache-efficiency" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Chunking:</strong> K-space data is too large for constant memory. The code breaks data into 64KB "chunks" and transfers them one by one.</li>
<li><strong>AoS (Array of Structures):</strong> Storing <span class="arithmatex">\(k_x, k_y, k_z\)</span> in three separate arrays is inefficient for the constant cache. By using an <strong>Array of Structures</strong>, all three values fit into a single cache line, drastically reducing DRAM requests.</li>
</ul>
<h2 id="en-summary">17.4 Summary<a class="headerlink" href="#en-summary" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Performance Gain:</strong> The final optimized version is roughly <strong>10x faster</strong> than the basic GPU version and orders of magnitude faster than the CPU.</li>
<li><strong>Clinical Impact:</strong> By reducing reconstruction time to approximately one minute, advanced non-Cartesian MRI becomes a viable tool for doctors to use in real-time.</li>
<li><strong>Lesson:</strong> Successful optimization requires understanding the math (Gather vs. Scatter) and the hardware (SFUs and Constant Cache).</li>
</ul>
<hr />
<p><strong>Key Takeaway:</strong> Chapter 17 teaches that "Porting" code isn't enough. You must <strong>reformulate</strong> the algorithm (using Loop Fission and the Gather approach) to match GPU hardware strengths like the Special Function Units and Constant Cache.</p>
</div>
<div class="tabbed-block">
<p>Chụp cộng hưởng từ (MRI) là một công cụ chẩn đoán y tế quan trọng. Chương này sử dụng quá trình tái tạo hình ảnh MRI để minh họa cách tối ưu hóa các kernel liên quan đến các công thức toán học phức tạp và yêu cầu băng thông bộ nhớ cao.</p>
<h2 id="vi-background">17.1 Bối cảnh<a class="headerlink" href="#vi-background" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Quy trình MRI:</strong> Bao gồm hai giai đoạn: <strong>Thu nhận (Acquisition)</strong> (quét) và <strong>Tái tạo (Reconstruction)</strong> (tạo ra hình ảnh).</li>
<li><strong>K-Space:</strong> Dữ liệu được lấy mẫu trong miền tần số (k-space).</li>
<li><strong>Cartesian vs. Non-Cartesian:</strong><ul>
<li><strong>Quét Cartesian</strong> nằm trên một lưới đồng nhất và có thể được giải nhanh chóng bằng phép biến đổi Fourier nhanh (FFT).</li>
<li><strong>Quét Non-Cartesian</strong> (ví dụ: xoắn ốc) tốt hơn để chụp các cơ quan đang chuyển động hoặc bệnh nhân nhưng khó giải hơn nhiều. Chúng yêu cầu <strong>Tái tạo lặp (Iterative Reconstruction)</strong>.</li>
</ul>
</li>
<li><strong>Nút thắt cổ chai:</strong> Trên một CPU tuần tự cao cấp, một lần tái tạo 3D duy nhất có thể mất <strong>3 giờ</strong>, hiệu suất này quá chậm để sử dụng trong lâm sàng.</li>
</ul>
<h2 id="vi-iterative">17.2 Tái tạo lặp<a class="headerlink" href="#vi-iterative" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Mô hình toán học:</strong> Sử dụng cách tiếp cận bộ giải tuyến tính để ước tính giá trị voxel (<span class="arithmatex">\(\rho\)</span>) từ các mẫu không đều.</li>
<li><strong>Quy mô vấn đề:</strong> Ngay cả một bản tái tạo voxel <span class="arithmatex">\(128^3\)</span> khiêm tốn cũng liên quan đến hàng triệu phép tính.</li>
<li><strong>Mục tiêu:</strong> Giảm thời gian tái tạo từ hàng giờ xuống còn <strong>vài phút</strong> bằng cách sử dụng GPU.</li>
</ul>
<h2 id="vi-optimization">17.3 Tính toán <span class="arithmatex">\(F^H D\)</span> (Tối ưu hóa từng bước)<a class="headerlink" href="#vi-optimization" title="Permanent link">&para;</a></h2>
<p>Trọng tâm của chương liên quan đến việc tối ưu hóa phần tốn kém nhất của bộ giải, phép tính vector <span class="arithmatex">\(F^H D\)</span>.</p>
<h3 id="buoc-1-cau-truc-song-song-scatter-vs-gather">Bước 1: Cấu trúc song song (Scatter vs. Gather)<a class="headerlink" href="#buoc-1-cau-truc-song-song-scatter-vs-gather" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Cách tiếp cận Scatter (Phân tán):</strong> Mỗi luồng lấy một đầu vào (mẫu k-space) và cập nhật tất cả các voxel đầu ra. Điều này đòi hỏi sử dụng nhiều <strong>Atomic Operations</strong>, khiến nó rất chậm.</li>
<li><strong>Cách tiếp cận Gather (Tập hợp - Được ưu tiên):</strong> Mỗi luồng được gán cho một voxel đầu ra và "tập hợp" các đóng góp từ tất cả các mẫu đầu vào. Điều này loại bỏ nhu cầu về atomic và nhanh hơn nhiều.</li>
<li><strong>Loop Fission (Phân tách vòng lặp):</strong> Để kích hoạt cách tiếp cận Gather, các tác giả sử dụng "loop fission" để chia phép tính thành hai kernel riêng biệt, đảm bảo dữ liệu sẵn sàng khi các luồng cần tập hợp nó.</li>
</ul>
<h3 id="buoc-2-quan-ly-bang-thong-bo-nho">Bước 2: Quản lý băng thông bộ nhớ<a class="headerlink" href="#buoc-2-quan-ly-bang-thong-bo-nho" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Sử dụng Register:</strong> Trong vòng lặp ban đầu, luồng đọc đi đọc lại các tọa độ voxel <span class="arithmatex">\((x, y, z)\)</span> từ bộ nhớ global.</li>
<li><strong>Giải pháp:</strong> Tải các tọa độ này vào <strong>Registers</strong> một lần trước khi vòng lặp bắt đầu. Điều này làm tăng tỷ lệ tính toán trên bộ nhớ từ <strong>0.23 lên 0.46 OP/B</strong>.</li>
</ul>
<h3 id="buoc-3-luong-giac-phan-cung-sfus">Bước 3: Lượng giác phần cứng (SFUs)<a class="headerlink" href="#buoc-3-luong-giac-phan-cung-sfus" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Nút thắt lượng giác:</strong> Các phép toán yêu cầu các lệnh gọi <code>sin()</code> và <code>cos()</code> liên tục.</li>
<li><strong>Giải pháp:</strong> Sử dụng các <strong>Hàm nội tại (Intrinsic Functions)</strong> (<code>__sin()</code>, <code>__cos()</code>). Các hàm này được thực thi bởi các <strong>Đơn vị chức năng đặc biệt (SFU)</strong> của GPU.</li>
<li><strong>Đánh đổi:</strong> Các hàm này nhanh hơn nhiều nhưng độ chính xác thấp hơn một chút. Các tác giả sử dụng <strong>PSNR</strong> (Peak Signal-to-Noise Ratio) để chứng minh tổn thất độ chính xác là không đáng kể đối với chẩn đoán y tế.</li>
</ul>
<h3 id="buoc-4-constant-memory-hieu-qua-cache">Bước 4: Constant Memory &amp; Hiệu quả Cache<a class="headerlink" href="#buoc-4-constant-memory-hieu-qua-cache" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Chia nhỏ (Chunking):</strong> Dữ liệu k-space quá lớn đối với bộ nhớ constant. Mã nguồn chia dữ liệu thành các "khối" 64KB và chuyển chúng từng cái một.</li>
<li><strong>AoS (Array of Structures):</strong> Lưu trữ <span class="arithmatex">\(k_x, k_y, k_z\)</span> trong ba mảng riêng biệt là không hiệu quả cho bộ nhớ cache constant. Bằng cách sử dụng <strong>Mảng các cấu trúc</strong>, cả ba giá trị nằm gọn trong một dòng cache duy nhất, giảm đáng kể các yêu cầu DRAM.</li>
</ul>
<h2 id="vi-summary">17.4 Tóm tắt<a class="headerlink" href="#vi-summary" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Cải thiện hiệu suất:</strong> Phiên bản tối ưu hóa cuối cùng nhanh hơn khoảng <strong>10 lần</strong> so với phiên bản GPU cơ bản và nhanh hơn nhiều bậc so với CPU.</li>
<li><strong>Tác động lâm sàng:</strong> Bằng cách giảm thời gian tái tạo xuống còn khoảng một phút, MRI non-Cartesian nâng cao trở thành một công cụ khả thi để các bác sĩ sử dụng trong thời gian thực.</li>
<li><strong>Bài học:</strong> Tối ưu hóa thành công đòi hỏi sự hiểu biết về toán học (Gather vs. Scatter) và phần cứng (SFUs và Constant Cache).</li>
</ul>
<hr />
<p><strong>Điểm chính:</strong> Chương 17 dạy rằng việc "chuyển đổi" mã nguồn là không đủ. Bạn phải <strong>xây dựng lại</strong> thuật toán (sử dụng Loop Fission và cách tiếp cận Gather) để phù hợp với thế mạnh phần cứng của GPU như các Đơn vị chức năng đặc biệt và Constant Cache.</p>
</div>
</div>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/mtuann" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/in/mtuann" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://x.com/mtuann6" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "navigation.tracking", "navigation.indexes", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../javascripts/lang-sync.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>