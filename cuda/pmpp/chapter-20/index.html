
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mtuann.github.io/blog/cuda/pmpp/chapter-20/">
      
      
        <link rel="prev" href="../chapter-19/">
      
      
        <link rel="next" href="../chapter-21/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Chapter 20: Heterogeneous Clusters - Tuan's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Outfit:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Outfit";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-20-programming-a-heterogeneous-cluster" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Tuan&#39;s Blog" class="md-header__button md-logo" aria-label="Tuan's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tuan's Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 20: Heterogeneous Clusters
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/mtuann/blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    mtuann/blog
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ml/theory/" class="md-tabs__link">
          
  
  
    
  
  Machine Learning

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../genai/" class="md-tabs__link">
          
  
  
    
  
  Generative AI

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../ai-systems/" class="md-tabs__link">
        
  
  
    
  
  AI Systems

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  CUDA Engineering

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../efficient-ai/" class="md-tabs__link">
        
  
  
    
  
  Efficient AI

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../trustworthy-ai/" class="md-tabs__link">
        
  
  
    
  
  Trustworthy AI

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../paper-reviews/" class="md-tabs__link">
        
  
  
    
  
  Paper Reviews

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Tuan&#39;s Blog" class="md-nav__button md-logo" aria-label="Tuan's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Tuan's Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mtuann/blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    mtuann/blog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Machine Learning
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Machine Learning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ml/theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Theory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ml/practice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Practice
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../genai/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Generative AI
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Generative AI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../genai/transformer-attention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transformer Foundations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai-systems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Systems
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    CUDA Engineering
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    CUDA Engineering
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    PMPP Book
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2" id="__nav_5_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    PMPP Book
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1: Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2: Data Parallel Computing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3: Multidimensional Grids
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4: Compute Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5: Memory Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6: Performance Considerations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7: Convolution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8: Stencil
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9: Parallel Histogram
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 10: Reduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 11: Prefix Sum (Scan)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 12: Parallel Merge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 13: Parallel Sorting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 14: Sparse Matrix Computation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 15: Parallel Graph Algorithms
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 16: Deep Learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 17: MRI Reconstruction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 18: Molecular Dynamics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 19: Programming Strategy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Chapter 20: Heterogeneous Clusters
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 20: Heterogeneous Clusters
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#en-background" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1 Background
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-stencil" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.2 A Running Example: 3D Stencil
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-mpi-basics" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.3 Message Passing Interface (MPI) Basics
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.4 Point-to-Point Communication
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-overlapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.5 Overlapping Computation and Communication
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-collective" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.6 Collective Communication
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-cuda-aware" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.7 CUDA-Aware MPI
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.8 Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-background" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1 Bối cảnh
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-stencil" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.2 Ví dụ thực tế: 3D Stencil
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-mpi-basics" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.3 Cơ bản về Giao diện Truyền Thông báo (MPI)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.4 Truyền thông Điểm-đến-Điểm (Point-to-Point)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-overlapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.5 Chồng lấp Tính toán và Truyền thông
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-collective" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.6 Truyền thông tập thể (Collective Communication)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-cuda-aware" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.7 CUDA-Aware MPI
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.8 Tóm tắt
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 21: Dynamic Parallelism
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 22: Evolution and Trends
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter-23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 23: Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix-a/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Appendix A: Numerical Issues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../engineer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GPU Engineer Roadmap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../efficient-ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Efficient AI
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../trustworthy-ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Trustworthy AI
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper-reviews/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Paper Reviews
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#en-background" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1 Background
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-stencil" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.2 A Running Example: 3D Stencil
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-mpi-basics" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.3 Message Passing Interface (MPI) Basics
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.4 Point-to-Point Communication
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-overlapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.5 Overlapping Computation and Communication
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-collective" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.6 Collective Communication
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-cuda-aware" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.7 CUDA-Aware MPI
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#en-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.8 Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-background" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1 Bối cảnh
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-stencil" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.2 Ví dụ thực tế: 3D Stencil
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-mpi-basics" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.3 Cơ bản về Giao diện Truyền Thông báo (MPI)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.4 Truyền thông Điểm-đến-Điểm (Point-to-Point)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-overlapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.5 Chồng lấp Tính toán và Truyền thông
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-collective" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.6 Truyền thông tập thể (Collective Communication)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-cuda-aware" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.7 CUDA-Aware MPI
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.8 Tóm tắt
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="chapter-20-programming-a-heterogeneous-cluster">Chapter 20: Programming a Heterogeneous Cluster<a class="headerlink" href="#chapter-20-programming-a-heterogeneous-cluster" title="Permanent link">&para;</a></h1>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">English</label><label for="__tabbed_1_2">Tiếng Việt</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>This chapter marks the beginning of <strong>Part IV: Advanced Practices</strong>. It shifts from a single machine to <strong>High-Performance Computing (HPC) clusters</strong>, teaching how to combine CUDA with the <strong>Message Passing Interface (MPI)</strong> to scale applications across multiple nodes.</p>
<h2 id="en-background">20.1 Background<a class="headerlink" href="#en-background" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>HPC Clusters:</strong> Modern supercomputers consist of thousands of "nodes." Each node has its own CPUs (Host) and GPUs (Devices).</li>
<li><strong>The Challenge:</strong> Nodes do not share memory. To work together on a single problem, they must "pass messages" over a network.</li>
<li><strong>MPI:</strong> The industry standard for distributed memory programming.</li>
</ul>
<h2 id="en-stencil">20.2 A Running Example: 3D Stencil<a class="headerlink" href="#en-stencil" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Application:</strong> Modeling heat transfer in a 3D duct using a 25-point Jacobi iterative stencil.</li>
<li><strong>Domain Partitioning:</strong> The 3D grid is sliced along the <span class="arithmatex">\(Z\)</span>-axis into several <strong>Domain Partitions</strong> (e.g., <span class="arithmatex">\(D0, D1, D2, D3\)</span>). Each partition is assigned to a different MPI process (and therefore a different GPU).</li>
<li><strong>Dependency:</strong> Just like in Chapter 8, each slice needs data from its neighbors to calculate the next step. In a cluster, these neighbors live on different physical machines.</li>
</ul>
<h2 id="en-mpi-basics">20.3 Message Passing Interface (MPI) Basics<a class="headerlink" href="#en-mpi-basics" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>SPMD Model:</strong> Like CUDA, MPI uses a "Single Program Multiple Data" approach where every node runs the exact same code but acts differently based on its ID.</li>
<li><strong>MPI Rank:</strong> Each process is assigned a unique ID called a <strong>Rank</strong> (analogous to a <code>threadIdx</code> for a whole machine).</li>
<li><strong>Core Functions:</strong><ul>
<li><code>MPI_Init</code> / <code>MPI_Finalize</code>: Start and stop the MPI environment.</li>
<li><code>MPI_Comm_rank</code>: Identify the current process Rank.</li>
<li><code>MPI_Comm_size</code>: Find the total number of processes in the cluster.</li>
</ul>
</li>
</ul>
<h2 id="en-communication">20.4 Point-to-Point Communication<a class="headerlink" href="#en-communication" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Send/Recv:</strong> Uses <code>MPI_Send</code> and <code>MPI_Recv</code> to move data between specific nodes.</li>
<li><strong>The Data Server:</strong> The authors illustrate a model where one process acts as a data server, distributing initial grid slices to "Compute Nodes" and gathering results at the end.</li>
<li><strong>Halo Exchange:</strong> The process of nodes trading their boundary slices so they have the "ghost cells" needed for the next stencil calculation.</li>
</ul>
<h2 id="en-overlapping">20.5 Overlapping Computation and Communication<a class="headerlink" href="#en-overlapping" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>The Latency Problem:</strong> Network communication is much slower than GPU math. If the GPU sits idle while the network moves data, performance is poor.</li>
<li><strong>CUDA Streams:</strong> A stream is a sequence of operations (kernels, memory copies) that execute in order. Different streams can execute <strong>simultaneously</strong>.</li>
<li>
<p><strong>The Two-Stage Strategy:</strong></p>
<ol>
<li><strong>Stage 1 (Boundary):</strong> The GPU calculates only the edge slices of the grid and immediately starts a <code>cudaMemcpyAsync</code> to the host.</li>
<li><strong>Stage 2 (Internal):</strong> While the edges are being sent over the network, the GPU calculates the massive "internal" part of the grid in a <strong>separate stream</strong>.</li>
</ol>
</li>
<li>
<p><strong>Pinned Memory (<code>cudaHostAlloc</code>):</strong> Necessary for "Asynchronous" transfers. It prevents the operating system from moving data in RAM, allowing the GPU to copy data to the host without stopping the CPU.</p>
</li>
</ul>
<h2 id="en-collective">20.6 Collective Communication<a class="headerlink" href="#en-collective" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Synchronization:</strong> Introduces <code>MPI_Barrier</code>, which forces every node in the cluster to wait until all have reached that point.</li>
<li><strong>Other Patterns:</strong> Mentions broadcast, reduce, and gather—functions optimized by vendors to move data across all nodes efficiently.</li>
</ul>
<h2 id="en-cuda-aware">20.7 CUDA-Aware MPI<a class="headerlink" href="#en-cuda-aware" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Modern Optimization:</strong> Explains that newer MPI libraries (like OpenMPI or MVAPICH2) can point directly to <strong>GPU memory addresses</strong>.</li>
<li><strong>Benefit:</strong> The programmer no longer has to manually copy data from GPU to CPU before sending it over the network. This simplifies the code and allows the hardware to optimize the transfer path.</li>
</ul>
<h2 id="en-summary">20.8 Summary<a class="headerlink" href="#en-summary" title="Permanent link">&para;</a></h2>
<ul>
<li>Scaling to a cluster requires a "Symbiotic Relationship" between MPI (inter-node) and CUDA (intra-node).</li>
<li>The key to high performance in a cluster is using <strong>Streams</strong> and <strong>Asynchronous Transfers</strong> to hide the "Network Wall" behind the GPU's "Compute Power."</li>
</ul>
<hr />
<p><strong>Key Takeaway:</strong> Chapter 20 teaches you how to break the "single-node" limit. The essential lesson is <strong>Communication-Hiding</strong>: using CUDA Streams to ensure the GPU is always doing internal math while the network is busy trading boundary data.</p>
</div>
<div class="tabbed-block">
<p>Chương này đánh dấu sự bắt đầu của <strong>Phần IV: Thực hành Nâng cao (Advanced Practices)</strong>. Nó chuyển từ một máy đơn lẻ sang các <strong>cụm tính toán hiệu năng cao (HPC clusters)</strong>, dạy cách kết hợp CUDA với <strong>Giao diện Truyền Thông báo (MPI)</strong> để mở rộng các ứng dụng trên nhiều nút (node).</p>
<h2 id="vi-background">20.1 Bối cảnh<a class="headerlink" href="#vi-background" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Cụm HPC:</strong> Các siêu máy tính hiện đại bao gồm hàng nghìn "nút". Mỗi nút có CPU (Host) và GPU (Device) riêng.</li>
<li><strong>Thách thức:</strong> Các nút không chia sẻ bộ nhớ. Để làm việc cùng nhau trong một vấn đề duy nhất, chúng phải "truyền thông báo" qua mạng.</li>
<li><strong>MPI:</strong> Tiểu chuẩn công nghiệp cho lập trình bộ nhớ phân tán.</li>
</ul>
<h2 id="vi-stencil">20.2 Ví dụ thực tế: 3D Stencil<a class="headerlink" href="#vi-stencil" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Ứng dụng:</strong> Mô phỏng sự truyền nhiệt trong một ống dẫn 3D bằng cách sử dụng stencil lặp Jacobi 25 điểm.</li>
<li><strong>Phân vùng miền (Domain Partitioning):</strong> Lưới 3D được cắt dọc theo trục <span class="arithmatex">\(Z\)</span> thành nhiều <strong>Phân vùng miền</strong> (ví dụ: <span class="arithmatex">\(D0, D1, D2, D3\)</span>). Mỗi phân vùng được gán cho một tiến trình MPI khác nhau (và do đó là một GPU khác nhau).</li>
<li><strong>Sự phụ thuộc:</strong> Giống như trong Chương 8, mỗi lát cắt cần dữ liệu từ các nút lân cận để tính toán bước tiếp theo. Trong một cụm máy tính, những nút lân cận này nằm trên các máy vật lý khác nhau.</li>
</ul>
<h2 id="vi-mpi-basics">20.3 Cơ bản về Giao diện Truyền Thông báo (MPI)<a class="headerlink" href="#vi-mpi-basics" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Mô hình SPMD:</strong> Giống như CUDA, MPI sử dụng cách tiếp cận "Single Program Multiple Data" trong đó mọi nút chạy cùng một mã nhưng hoạt động khác nhau dựa trên ID của nó.</li>
<li><strong>Rank MPI:</strong> Mỗi tiến trình được gán một ID duy nhất gọi là <strong>Rank</strong> (tương tự như <code>threadIdx</code> nhưng cho cả một máy).</li>
<li><strong>Các hàm cốt lõi:</strong><ul>
<li><code>MPI_Init</code> / <code>MPI_Finalize</code>: Bắt đầu và kết thúc môi trường MPI.</li>
<li><code>MPI_Comm_rank</code>: Xác định Rank của tiến trình hiện tại.</li>
<li><code>MPI_Comm_size</code>: Tìm tổng số tiến trình trong cụm.</li>
</ul>
</li>
</ul>
<h2 id="vi-communication">20.4 Truyền thông Điểm-đến-Điểm (Point-to-Point)<a class="headerlink" href="#vi-communication" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Send/Recv:</strong> Sử dụng <code>MPI_Send</code> và <code>MPI_Recv</code> để di chuyển dữ liệu giữa các nút cụ thể.</li>
<li><strong>Máy chủ dữ liệu:</strong> Các tác giả minh họa một mô hình trong đó một tiến trình hoạt động như máy chủ dữ liệu, phân phối các lát lưới ban đầu cho các "Nút tính toán (Compute Nodes)" và thu thập kết quả cuối cùng.</li>
<li><strong>Trao đổi Halo:</strong> Quá trình các nút trao đổi các lát ranh giới của chúng để chúng có các "ô ma (ghost cells)" cần thiết cho phép tính stencil tiếp theo.</li>
</ul>
<h2 id="vi-overlapping">20.5 Chồng lấp Tính toán và Truyền thông<a class="headerlink" href="#vi-overlapping" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Vấn đề độ trễ:</strong> Truyền thông qua mạng chậm hơn nhiều so với tính toán trên GPU. Nếu GPU nhàn rỗi trong khi mạng di chuyển dữ liệu, hiệu suất sẽ rất kém.</li>
<li><strong>CUDA Streams:</strong> Một stream là một chuỗi các thao tác (kernel, sao chép bộ nhớ) thực thi theo thứ tự. Các stream khác nhau có thể thực thi <strong>đồng thời</strong>.</li>
<li>
<p><strong>Chiến lược hai giai đoạn:</strong></p>
<ol>
<li><strong>Giai đoạn 1 (Ranh giới):</strong> GPU chỉ tính toán các lát cạnh của lưới và bắt đầu ngay lập tức một lệnh <code>cudaMemcpyAsync</code> sang host.</li>
<li><strong>Giai đoạn 2 (Bên trong):</strong> Trong khi các cạnh đang được gửi qua mạng, GPU tính toán phần lớn "bên trong" của lưới trong một <strong>stream riêng biệt</strong>.</li>
</ol>
</li>
<li>
<p><strong>Pinned Memory (<code>cudaHostAlloc</code>):</strong> Cần thiết cho các lần truyền "Bất đồng bộ". Nó ngăn hệ điều hành di chuyển dữ liệu trong RAM, cho phép GPU sao chép dữ liệu sang host mà không làm dừng CPU.</p>
</li>
</ul>
<h2 id="vi-collective">20.6 Truyền thông tập thể (Collective Communication)<a class="headerlink" href="#vi-collective" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Đồng bộ hóa:</strong> Giới thiệu <code>MPI_Barrier</code>, buộc mọi nút trong cụm phải đợi cho đến khi tất cả đều đạt đến điểm đó.</li>
<li><strong>Các mẫu khác:</strong> Đề cập đến broadcast, reduce và gather—các hàm được các nhà cung cấp tối ưu hóa để di chuyển dữ liệu qua tất cả các nút một cách hiệu quả.</li>
</ul>
<h2 id="vi-cuda-aware">20.7 CUDA-Aware MPI<a class="headerlink" href="#vi-cuda-aware" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Tối ưu hóa hiện đại:</strong> Giải thích rằng các thư viện MPI mới hơn (như OpenMPI hoặc MVAPICH2) có thể trỏ trực tiếp đến <strong>địa chỉ bộ nhớ GPU</strong>.</li>
<li><strong>Lợi ích:</strong> Lập trình viên không còn phải sao chép dữ liệu từ GPU sang CPU một cách thủ công trước khi gửi qua mạng. Điều này đơn giản hóa mã nguồn và cho phép phần cứng tối ưu hóa đường truyền.</li>
</ul>
<h2 id="vi-summary">20.8 Tóm tắt<a class="headerlink" href="#vi-summary" title="Permanent link">&para;</a></h2>
<ul>
<li>Mở rộng lên một cụm máy tính đòi hỏi một "Mối quan hệ cộng sinh" giữa MPI (giữa các nút) và CUDA (trong một nút).</li>
<li>Chìa khóa để đạt hiệu năng cao trong một cụm là sử dụng <strong>Streams</strong> và <strong>Truyền bất đồng bộ</strong> để che giấu "Bức tường Mạng" đằng sau "Sức mạnh tính toán" của GPU.</li>
</ul>
<hr />
<p><strong>Điểm chính:</strong> Chương 20 dạy bạn cách phá vỡ giới hạn "nút đơn". Bài học thiết yếu là <strong>Che giấu truyền thông (Communication-Hiding)</strong>: sử dụng CUDA Streams để đảm bảo GPU luôn thực hiện tính toán bên trong trong khi mạng đang bận rộn trao đổi dữ liệu ranh giới.</p>
</div>
</div>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/mtuann" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/in/mtuann" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://x.com/mtuann6" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "navigation.tracking", "navigation.indexes", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../javascripts/lang-sync.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>